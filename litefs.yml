# LiteFS configuration for Django application

# FUSE mount directory for LiteFS
fuse:
  dir: "/litefs"

# Data directory for the database files
data:
  dir: "/var/lib/litefs"

# Lease configuration for Fly.io
lease:
  type: "consul"
  advertise-url: "http://${HOSTNAME}:20202"
  candidate: ${FLY_REGION == PRIMARY_REGION}
  consul:
    url: "${FLY_CONSUL_URL}"
    key: "litefs/${FLY_APP_NAME}"

# HTTP server for LiteFS management
http:
  addr: ":20202"

# Proxy configuration
proxy:
  addr: ":8080"
  target: "localhost:8000"
  db: "db.sqlite3"

# Execute Django application with gunicorn
exec: "sh -c 'export DJANGO_SETTINGS_MODULE=config.settings.production && python manage.py collectstatic --noinput && python manage.py migrate --check || python manage.py migrate && python manage.py shell -c \"from django.contrib.auth.models import User; User.objects.filter(username=\\\"Garalulu\\\").exists() or User.objects.create_superuser(\\\"Garalulu\\\", \\\"\\\", \\\"defaultpassword\\\")\" 2>/dev/null || echo \"Admin user already exists\" && gunicorn --bind 0.0.0.0:8000 config.wsgi:application'"